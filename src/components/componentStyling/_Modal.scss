@use 'variables' as *;
@use 'mixins' as *;

/* The Modal (background) */
.modal {
  display: flex;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
  align-items: center;
  justify-content: center;
}

.modal-content {
  background-color: $lighter-green;
  padding: clamp(8px, 0.9vw, 14px); /* Increased for better spacing */
  border: 2px solid $border-color;
  height: clamp(500px, 85vh, 950px); /* Significantly increased height */
  width: clamp(650px, 85vw, 1350px); /* Significantly increased width */
  max-width: 95vw; /* Increased to use more screen space */
  max-height: 95vh; /* Increased to use more screen space */
  position: relative;
  overflow-y: auto; /* Enable vertical scrolling */
  overflow-x: hidden; /* Prevent horizontal scrolling */
  border-radius: 10px; /* Slightly increased for modern look */
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); /* Enhanced shadow for better depth */
}

.modal-header {
  @include display-flex($direction: row, $align: center, $justify: space-between);
  border-bottom: 2px solid #ddd;
  padding-bottom: clamp(2px, 0.3vw, 4px); /* Reduced header padding for compactness */
  margin-bottom: clamp(8px, 1vw, 14px); /* Reduced margin for tighter spacing */
}

.modal-header p {
  margin: 0;
  font-size: $medium; /* Slightly reduced font size for more compact header */
  font-weight: bold;
  color: $text-color;
}

.modal-header h2 {
  margin: 0;
  font-size: $medium; /* Slightly reduced font size for more compact header */
  font-weight: bold;
  color: $text-color;
}

.close-modal-button {
  font-size: clamp(20px, 2.5vw, 32px); /* Reduced from clamp(24px, 3vw, 36px) */
  font-weight: bold;
  color: #999;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: clamp(3px, 0.4vw, 6px); /* Reduced from clamp(4px, 0.5vw, 8px) */
  border-radius: 4px;
}

.close-modal-button:hover,
.close-modal-button:focus {
  color: #000;
  background-color: rgba(0, 0, 0, 0.1);
  text-decoration: none;
}

.modal-body {
  @include display-flex($direction: column, $align: center, $justify: flex-start);
  gap: clamp(4px, 0.6vw, 8px); /* Reduced gap for tighter row spacing */

  form {
    width: 100%;
  }
}

.modal-file-number-container {
  @include display-flex($direction: row, $align: center, $justify: space-between);
  width: 100%;
  min-height: clamp(40px, 5.4vh, 60px); /* Slightly reduced for tighter spacing */
  margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px); /* Reduced vertical margin */
  background-color: $lightest-green;
  border: 2px solid $border-color;
  border-radius: 6px; /* Reduced from 8px */
  padding: clamp(3px, 0.4vw, 6px); /* Reduced from clamp(4px, 0.5vw, 8px) */
  transition: all 0.3s ease;

  &:focus-within {
    border-color: $main-color-hover;
    box-shadow: 0 0 0 3px rgba(122, 173, 13, 0.2);
  }
  label {
    margin-left: clamp(4px, 0.6vw, 10px); /* Reduced from clamp(6px, 0.8vw, 12px) */
    font-size: $small; /* Keep as small for better readability */
    font-weight: bold;
    margin-bottom: 0;
    white-space: nowrap;
    color: $text-color;
    line-height: 1.2; /* Added for better spacing */
  }
  p {
    font-size: 1.2vi;
    margin: 0;
  }
}

.modal-row {
  @include display-flex($direction: row, $align: center, $justify: space-between);
  gap: clamp(6px, 0.8vw, 12px); /* Slightly reduced gap */
}

.modal-form-group {
  @include display-flex($direction: row, $align: center, $justify: space-between);
  width: 100%;
  min-height: clamp(36px, 4.2vh, 56px); /* Slightly reduced for tighter spacing */
  margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px); /* Reduced vertical margin */
  background-color: $lightest-green;
  border: 2px solid $border-color;
  border-radius: 6px; /* Reduced from 8px */
  padding: clamp(3px, 0.4vw, 6px); /* Reduced from clamp(4px, 0.5vw, 8px) */
  transition: all 0.3s ease;
  box-sizing: border-box; /* Ensure consistent sizing calculation */

  &:focus-within {
    border-color: $main-color-hover;
    box-shadow: 0 0 0 3px rgba(122, 173, 13, 0.2);
  }

  label {
    margin-left: clamp(4px, 0.6vw, 10px); /* Reduced from clamp(6px, 0.8vw, 12px) */
    font-size: $small; /* Keep as small for better readability */
    font-weight: bold;
    margin-bottom: 0;
    white-space: nowrap;
    color: $text-color;
    line-height: 1.2; /* Added for better spacing */
  }

  .inputLarge,
  .inputMedium,
  .inputSmall {
    height: clamp(30px, 3.8vh, 44px); /* Reduced from clamp(32px, 4vh, 48px) */
    font-size: $small;
    text-align: right;
    border: 2px solid $border-color;
    border-radius: 4px; /* Reduced from 6px */
    padding: clamp(4px, 0.5vw, 8px); /* Added padding for better usability */
    box-sizing: border-box; /* Ensure consistent sizing */
  }

  .inputLarge {
    width: 80%;
  }

  .inputMedium {
    width: 60%;
  }

  .inputSmall {
    width: 20%;
  }

  .currencySelectViewFile {
    width: 12%;
    font-size: small;
  }
  select {
    width: 62%;
    padding: clamp(4px, 0.5vw, 8px); /* Reduced from 0.5rem */
    font-size: $small;
    text-align: right;
    border: 1px solid $border-color;
    border-radius: 4px;
    height: clamp(30px, 3.8vh, 44px); /* Added consistent height */
    box-sizing: border-box;
  }

  textarea {
    width: 80%;
    padding: clamp(6px, 0.8vw, 10px); /* Reduced from 0.5rem */
    font-size: $small;
    border: 1px solid $border-color;
    border-radius: 4px;
    min-height: clamp(60px, 8vh, 100px); /* Added minimum height */
    box-sizing: border-box;
    resize: vertical; /* Allow only vertical resize */
  }
  p {
    font-size: 1.2vi;
    margin: 0;
  }
}

.react-select-container {
  width: 60%;
}

.reactSelect {
  width: 60%;
  font-size: $small;
  text-align: right;
}

.reactSelectWide {
  width: 100%;
  font-size: $small;
  text-align: right;
}

.select-company-container {
  @include display-flex($direction: row, $align: center, $justify: flex-end);
  width: 70%;
}

.modal-footer {
  @include display-flex($direction: row, $align: center, $justify: flex-end);
  width: 100%;
  margin-top: clamp(16px, 2vw, 28px); /* Increased spacing above footer */
  padding-top: clamp(8px, 1vw, 16px); /* Added padding for visual separation */
  border-top: 1px solid rgba(0, 0, 0, 0.1); /* Added subtle border for separation */
}

.modal-footer-button-container {
  @include display-flex($direction: row, $align: center, $justify: center);
  width: clamp(140px, 14vw, 220px); /* Increased size for better buttons */
  height: clamp(48px, 6.5vh, 70px); /* Increased height for better proportions */
  background-color: $lightest-green;
  border: 1px solid $border-color;
  border-radius: 8px; /* Increased border radius for modern look */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Added subtle shadow */
}

.editFeeGenerateInvoice {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* Enhanced gradient */
  color: white;
  border: none;
  padding: clamp(8px, 1vw, 14px) clamp(12px, 1.5vw, 20px); /* Increased padding */
  font-size: $small;
  font-weight: 600; /* Added font weight */
  margin-right: 10px;
  border-radius: 6px; /* Increased border radius */
  cursor: pointer;
  transition: all 0.3s ease; /* Enhanced transition */
  box-shadow: 0 2px 6px rgba(0, 123, 255, 0.3); /* Added shadow with brand color */
}

.editFeeGenerateInvoice:hover {
  background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
  transform: translateY(-1px); /* Subtle lift effect */
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
}

.modal-submit {
  background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%); /* Enhanced gradient */
  color: white;
  border: none;
  padding: clamp(8px, 1vw, 14px) clamp(12px, 1.5vw, 20px); /* Increased padding */
  font-size: $small;
  font-weight: 600; /* Added font weight */
  margin-right: 10px;
  border-radius: 6px; /* Increased border radius */
  cursor: pointer;
  transition: all 0.3s ease; /* Enhanced transition */
  box-shadow: 0 2px 6px rgba(76, 175, 80, 0.3); /* Added shadow with brand color */
}

.modal-submit:hover {
  background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
  transform: translateY(-1px); /* Subtle lift effect */
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
}

.modal-cancel {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); /* Enhanced gradient */
  color: white;
  border: none;
  padding: clamp(8px, 1vw, 14px) clamp(12px, 1.5vw, 20px); /* Increased padding */
  font-size: $small;
  font-weight: 600; /* Added font weight */
  border-radius: 6px; /* Increased border radius */
  cursor: pointer;
  transition: all 0.3s ease; /* Enhanced transition */
  box-shadow: 0 2px 6px rgba(244, 67, 54, 0.3); /* Added shadow with brand color */
}

.modal-cancel:hover {
  background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
  transform: translateY(-1px); /* Subtle lift effect */
  box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
}

.react-select-container {
  display: flex;
  align-items: center;
}

.add-company-button {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* Enhanced gradient */
  color: white;
  border: none;
  padding: clamp(3px, 0.5vw, 5px) clamp(5px, 0.6vw, 8px); /* Increased padding */
  margin-left: 10px;
  border-radius: 6px; /* Increased border radius */
  cursor: pointer;
  transition: all 0.3s ease; /* Enhanced transition */
  font-size: $small;
  font-weight: 600; /* Added font weight */
  box-shadow: 0 2px 6px rgba(0, 123, 255, 0.3); /* Added shadow */
}

.add-company-button:hover {
  background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
  transform: translateY(-1px); /* Subtle lift effect */
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
}

.additional-parties-container {
  display: block; /* Try using block instead of flex to eliminate any flexbox complications */
  width: 100%; /* Match standard modal form groups */
  margin: 0; /* Remove any potential margin */
  padding: 0; /* Remove any potential padding */
  border: none; /* Remove any potential border */
  background: transparent; /* Remove any potential background */

  .additional-parties-header {
    @include display-flex(
      $direction: row,
      $align: center,
      $justify: space-between
    ); /* Match standard form group alignment */

    min-height: clamp(36px, 4.2vh, 56px); /* Match standard modal form groups */
    margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px); /* Match standard modal form groups */
    background-color: $lightest-green;
    border: 2px solid $border-color; /* Match standard modal form groups */
    border-radius: 6px; /* Match standard modal form groups */
    padding: clamp(3px, 0.4vw, 6px); /* Match standard modal form groups */
    transition: all 0.3s ease; /* Match standard modal form groups */
    box-sizing: border-box; /* Ensure proper sizing calculation */

    &:focus-within {
      border-color: $main-color-hover;
      box-shadow: 0 0 0 3px rgba(122, 173, 13, 0.2);
    }

    label {
      margin-left: clamp(4px, 0.6vw, 10px); /* Match standard label margin */
      font-size: $small;
      font-weight: bold;
      line-height: 1.2;
      margin-bottom: 0;
      white-space: nowrap;
      color: $text-color;
    }
  }

  .additional-party-content {
    @include display-flex($direction: row, $align: center, $justify: flex-start);

    min-height: clamp(36px, 4.2vh, 56px); /* Match standard modal form groups */
    margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px); /* Match standard modal form groups */
    border: 2px solid $border-color; /* Match standard modal form groups */
    border-radius: 6px; /* Match standard modal form groups */
    background-color: $lightest-green;
    padding: clamp(3px, 0.4vw, 6px); /* Match standard modal form groups */
    transition: all 0.3s ease; /* Match standard modal form groups */
    box-sizing: border-box; /* Ensure proper sizing calculation */

    &:focus-within {
      border-color: $main-color-hover;
      box-shadow: 0 0 0 3px rgba(122, 173, 13, 0.2);
    }

    .additional-party-row {
      @include display-flex($direction: row, $align: center, $justify: space-between);
      width: 100%; /* Use full width of container */

      .additional-party-name {
        @include display-flex($direction: column, $align: flex-start, $justify: center);
        width: 20%;
        font-size: $small; /* Match standard label size */
        margin-left: clamp(4px, 0.6vw, 10px); /* Match standard label margin */
        margin-right: clamp(3px, 0.4vw, 6px);

        input {
          margin: 0;
          border: 2px solid $border-color; /* Match standard input border */
          border-radius: 4px;
          height: clamp(30px, 3.8vh, 44px); /* Match standard input height */
          font-size: $small; /* Match standard input font size */
          padding: clamp(4px, 0.5vw, 8px); /* Match standard input padding */
          box-sizing: border-box;
        }
      }

      label {
        font-size: $small; /* Match standard label size */
        font-weight: bold;
        margin-bottom: clamp(3px, 0.4vw, 6px);
        line-height: 1.2;
        color: $text-color; /* Match standard label color */
        white-space: nowrap; /* Match standard label styling */
      }

      .adp-company-form-group {
        @include display-flex($direction: row, $align: center, $justify: space-between);
        width: 60%;
        min-height: clamp(30px, 3.8vh, 44px); /* Match input height from standard form groups */
        margin: clamp(2px, 0.3vw, 4px) clamp(1px, 0.1vw, 2px);
        border-radius: 4px;
      }
      .adp-contact-form-group {
        @include display-flex($direction: row, $align: center, $justify: space-between);
        width: 40%;
        min-height: clamp(30px, 3.8vh, 44px); /* Match input height from standard form groups */
        margin: clamp(2px, 0.3vw, 4px) clamp(1px, 0.1vw, 2px);
        border-radius: 4px;
      }

      .adp-select-container {
        @include display-flex($direction: row, $align: center, $justify: flex-start);
        width: 82%;
      }

      .adp_delete-button {
        background-color: #f44336; /* Red */
        color: white;
        border: none;
        width: clamp(24px, 2.4vw, 32px); /* Slightly larger for better visibility */
        height: clamp(30px, 3.2vh, 38px); /* Match input height better */
        font-size: $small; /* Match standard font size */
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-right: clamp(4px, 0.6vw, 10px); /* Match standard margins */
      }
    }
  }
}

/* Responsive adjustments for 1366x768 laptop screens - Enhanced Modal Design */
@media (max-width: 1366px) and (max-height: 768px) {
  .modal-content {
    padding: clamp(14px, 1.6vw, 24px) !important; /* Increased from previous compact design */
    height: clamp(450px, 85vh, 850px) !important; /* Increased height utilization */
    width: clamp(600px, 85vw, 1200px) !important; /* Increased width utilization */
    max-height: 95vh !important; /* Increased from 90vh */
    overflow-y: auto !important; /* Enable vertical scrolling */
    overflow-x: hidden !important;
  }

  .modal-header {
    padding-bottom: clamp(4px, 0.6vw, 8px) !important; /* Maintained compact header */
    margin-bottom: clamp(8px, 1vw, 14px) !important; /* Maintained compact spacing */
  }

  .modal-header p,
  .modal-header h2 {
    font-size: $medium !important; /* Maintained compact header text */
    margin: 0 !important;
  }

  .close-modal-button {
    font-size: clamp(20px, 2.5vw, 28px) !important; /* Reduced from clamp(24px, 3vw, 36px) */
    padding: clamp(3px, 0.4vw, 6px) !important;
  }

  .file-number-container {
    min-width: clamp(100px, 12vw, 160px) !important; /* Reduced from clamp(120px, 15vw, 200px) */
  }

  .modal-form-group {
    min-height: clamp(32px, 4vh, 48px) !important; /* Reduced from clamp(40px, 5vh, 60px) */
    margin: clamp(3px, 0.4vw, 6px) clamp(1px, 0.2vw, 4px) !important; /* Reduced margins */
    padding: clamp(3px, 0.4vw, 6px) !important; /* Reduced from clamp(4px, 0.5vw, 8px) */
    border-radius: 6px !important; /* Slightly reduced from 8px */
  }

  .modal-form-group label {
    margin-left: clamp(4px, 0.6vw, 8px) !important; /* Reduced from clamp(6px, 0.8vw, 12px) */
    font-size: $smaller !important; /* Reduced from $small */
  }

  .modal-form-group .inputLarge,
  .modal-form-group .inputMedium,
  .modal-form-group .inputSmall {
    height: clamp(28px, 3.5vh, 40px) !important; /* Reduced from clamp(32px, 4vh, 48px) */
    font-size: $smaller !important; /* Reduced from $small */
    padding: clamp(4px, 0.5vw, 8px) !important; /* Added padding for better usability */
  }

  .modal-form-group select {
    font-size: $smaller !important; /* Reduced from $small */
    padding: clamp(4px, 0.5vw, 8px) !important; /* Reduced from 0.5rem */
    height: clamp(28px, 3.5vh, 40px) !important; /* Added consistent height */
  }

  .modal-form-group textarea {
    font-size: $smaller !important; /* Reduced from $small */
    padding: clamp(4px, 0.5vw, 8px) !important; /* Reduced from 0.5rem */
    min-height: clamp(60px, 8vh, 100px) !important; /* Added minimum height */
  }

  .modal-form-group p {
    font-size: $smaller !important; /* Reduced text size */
  }

  /* React Select Components */
  .reactSelect,
  .reactSelectWide {
    font-size: $smaller !important; /* Reduced from $small */
  }

  .react-select-container {
    width: 65% !important; /* Slightly increased from 60% to utilize space better */
  }

  .select-company-container {
    width: 75% !important; /* Increased from 70% */
  }

  /* Modal Footer */
  .modal-footer {
    margin-top: clamp(12px, 1.5vw, 20px) !important; /* Reduced from 20px */
  }

  .modal-footer-button-container {
    width: clamp(120px, 12vw, 180px) !important; /* Reduced from 15vw */
    height: clamp(45px, 5.5vh, 60px) !important; /* Reduced from 7vh */
  }

  /* Modal Buttons */
  .modal-submit,
  .modal-cancel,
  .editFeeGenerateInvoice {
    font-size: $small !important; /* Reduced from $medium */
    padding: clamp(6px, 0.8vw, 10px) clamp(8px, 1vw, 14px) !important; /* Reduced padding */
    margin-right: 8px !important; /* Reduced from 10px */
  }

  .add-company-button {
    padding: 6px 10px !important; /* Reduced from 8px 12px */
    margin-left: 6px !important; /* Reduced from 8px */
    font-size: $smaller !important;
  }

  /* Additional Parties Container - Match Standard Design */
  .additional-parties-container {
    .additional-parties-header {
      min-height: clamp(
        32px,
        3.8vh,
        50px
      ) !important; /* Slightly smaller for responsive but match proportion */
      margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px) !important; /* Match standard margins */
      border: 2px solid $border-color !important; /* Match standard border */
      border-radius: 6px !important; /* Match standard border radius */
      padding: clamp(3px, 0.4vw, 6px) !important; /* Match standard padding */

      label {
        margin-left: clamp(4px, 0.6vw, 10px) !important; /* Match standard label margins */
        font-size: $small !important; /* Keep consistent with standard sizing */
        color: $text-color !important; /* Match standard label color */
      }
    }

    .additional-party-content {
      width: 100% !important; /* Match standard modal form groups */
      min-height: clamp(32px, 3.8vh, 50px) !important; /* Slightly smaller for responsive */
      margin: clamp(1px, 0.2vw, 2px) clamp(1px, 0.2vw, 3px) !important; /* Match standard margins */
      border: 2px solid $border-color !important; /* Match standard border */
      border-radius: 6px !important; /* Match standard border radius */
      padding: clamp(3px, 0.4vw, 6px) !important; /* Match standard padding */

      &:focus-within {
        border-color: $main-color-hover !important;
        box-shadow: 0 0 0 3px rgba(122, 173, 13, 0.2) !important;
      }

      .additional-party-row {
        width: 100% !important; /* Use full width of container */

        .additional-party-name {
          font-size: $small !important; /* Match standard responsive size */
          margin-left: clamp(4px, 0.6vw, 10px) !important; /* Match standard label margins */

          input {
            height: clamp(28px, 3.5vh, 40px) !important; /* Slightly smaller for responsive */
            font-size: $small !important; /* Match standard input size */
            padding: clamp(4px, 0.5vw, 8px) !important; /* Match standard padding */
            border: 2px solid $border-color !important; /* Match standard border */
          }
        }

        label {
          font-size: $small !important; /* Match standard responsive label size */
          margin-bottom: clamp(3px, 0.4vw, 6px) !important;
          color: $text-color !important; /* Match standard label color */
          font-weight: bold !important;
        }

        .adp-company-form-group,
        .adp-contact-form-group {
          min-height: clamp(30px, 3.8vh, 44px) !important; /* Match standard input height */
          margin: clamp(2px, 0.3vw, 4px) clamp(1px, 0.1vw, 2px) !important;
        }

        .adp_delete-button {
          width: clamp(24px, 2.4vw, 32px) !important; /* Slightly larger for better visibility */
          height: clamp(30px, 3.2vh, 38px) !important; /* Match input height better */
          font-size: $small !important; /* Match standard font size */
          margin-right: clamp(4px, 0.6vw, 10px) !important; /* Match standard margins */
        }
      }
    }
  }

  /* Improve space utilization for form groups */
  .modal-form-group .inputLarge {
    width: 82% !important; /* Increased from 80% */
  }

  .modal-form-group .inputMedium {
    width: 65% !important; /* Increased from 60% */
  }

  .modal-form-group .inputSmall {
    width: 25% !important; /* Increased from 20% */
  }

  .modal-form-group textarea {
    width: 82% !important; /* Increased from 80% */
  }

  .modal-form-group select {
    width: 65% !important; /* Increased from 62% */
  }

  /* Currency select styling */
  .currencySelectViewFile {
    width: 15% !important; /* Increased from 12% */
    font-size: $smaller !important;
    height: clamp(28px, 3.5vh, 40px) !important;
  }

  /* Modal body spacing */
  .modal-body {
    gap: clamp(6px, 0.8vw, 12px) !important; /* Add consistent gap between elements */
  }

  .modal-row {
    gap: clamp(8px, 1vw, 16px) !important; /* Add gap for better spacing */
    margin-bottom: clamp(6px, 0.8vw, 12px) !important; /* Add bottom margin */
  }

  /* Enhanced form element spacing and sizes */
  .modal-content {
    border-radius: 8px !important; /* Reduced from default 12px */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important; /* Slightly reduced shadow */
  }

  /* Universal Modal Improvements - Applied to all screen sizes */

  /* Enhanced scrollbar styling for modal content */
  .modal-content::-webkit-scrollbar {
    width: 8px; /* Thinner scrollbar */
  }

  .modal-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
  }

  .modal-content::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
  }

  .modal-content::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
  }

  /* Improved input and select focus states */
  .modal-form-group input:focus,
  .modal-form-group select:focus,
  .modal-form-group textarea:focus {
    outline: none;
    border-color: $main-color-hover;
    box-shadow: 0 0 0 2px rgba(122, 173, 13, 0.15);
  }

  /* React Select component improvements */
  .react-select__control {
    min-height: clamp(30px, 3.8vh, 44px) !important;
    border-radius: 4px !important;
    border-width: 1px !important;
  }

  .react-select__value-container {
    padding: clamp(2px, 0.3vw, 4px) clamp(6px, 0.8vw, 8px) !important;
  }

  .react-select__indicators {
    padding: clamp(2px, 0.3vw, 4px) !important;
  }

  .react-select__indicator-separator {
    margin: clamp(2px, 0.3vw, 4px) 0 !important;
  }

  .react-select__dropdown-indicator,
  .react-select__clear-indicator {
    padding: clamp(2px, 0.3vw, 4px) !important;
  }

  /* Enhanced table styling within modals */
  .modal-content table {
    font-size: $small;

    th,
    td {
      padding: clamp(4px, 0.5vw, 8px) clamp(6px, 0.8vw, 10px);
      border-width: 1px;
    }

    th {
      font-size: $small;
      font-weight: 600;
    }
  }

  /* Checkbox and radio button optimization */
  .modal-form-group input[type='checkbox'],
  .modal-form-group input[type='radio'] {
    width: clamp(14px, 1.8vw, 18px);
    height: clamp(14px, 1.8vw, 18px);
    margin: clamp(2px, 0.3vw, 4px);
  }

  /* Modal footer improvements */
  .modal-footer {
    flex-wrap: wrap; /* Allow wrapping on small spaces */
    gap: clamp(6px, 0.8vw, 10px); /* Consistent gap between buttons */
  }

  /* Better width utilization for form inputs */
  .modal-form-group .inputLarge {
    width: 82% !important; /* Increased from 80% */
  }

  .modal-form-group .inputMedium {
    width: 65% !important; /* Increased from 60% */
  }

  .modal-form-group .inputSmall {
    width: 25% !important; /* Increased from 20% */
  }

  .modal-form-group textarea {
    width: 82% !important; /* Increased from 80% */
  }

  .modal-form-group select {
    width: 65% !important; /* Increased from 62% */
  }

  .react-select-container {
    width: 65% !important; /* Increased from 60% */
  }

  .select-company-container {
    width: 75% !important; /* Increased from 70% */
  }

  /* Currency select styling */
  .currencySelectViewFile {
    width: 15% !important; /* Increased from 12% */
    font-size: $small;
    height: clamp(30px, 3.8vh, 44px);
    box-sizing: border-box;
  }
}

/* Enhanced responsive behavior for very compact screens */
@media (max-height: 700px) {
  .modal-content {
    max-height: 95vh !important; /* Use more of the available height */
    padding: clamp(8px, 1vw, 16px) !important; /* Further reduced padding */
  }

  .modal-form-group {
    min-height: clamp(28px, 3.5vh, 36px) !important; /* Even more compact */
    margin: clamp(2px, 0.3vw, 4px) clamp(1px, 0.2vw, 3px) !important;
  }

  .modal-header {
    padding-bottom: clamp(4px, 0.6vw, 8px) !important;
    margin-bottom: clamp(6px, 0.8vw, 12px) !important;
  }

  .modal-footer {
    margin-top: clamp(8px, 1vw, 16px) !important;
  }
}

/* Enhanced width utilization for very wide but short screens */
@media (min-width: 1200px) and (max-height: 768px) {
  .modal-content {
    width: clamp(600px, 80vw, 1200px) !important; /* Use more width when available */
  }

  .additional-party-content {
    width: 100% !important; /* Match standard modal form groups */
    min-height: clamp(32px, 3.8vh, 50px) !important; /* Match responsive sizing */
    border: 2px solid $border-color !important; /* Match standard border */
    border-radius: 6px !important; /* Match standard border radius */
  }

  /* Better layout for wide forms */
  .modal-row {
    flex-wrap: wrap !important;
    justify-content: space-between !important;
  }

  .modal-form-group {
    flex: 1 1 calc(50% - 8px) !important; /* Two-column layout when space allows */
    min-width: 280px !important; /* Minimum width for usability */
  }

  /* Override for fields that should remain full width */
  .modal-form-group.full-width,
  .modal-form-group:has(textarea),
  .modal-form-group:has(.reactSelectWide) {
    flex: 1 1 100% !important;
  }
}

/* Very large screen optimizations (large desktops, ultrawide monitors) */
@media (min-width: 1600px) {
  .modal-content {
    max-width: 1300px;
    width: clamp(800px, 65vw, 1300px);
  }

  .email-modal-content {
    max-width: 1100px;
  }

  .modal-form-group {
    /* Enable two-column layout for large screens */
    &.can-split {
      width: calc(50% - 8px);
      margin-right: 16px;
    }
  }
}

/* Height-specific optimizations for very short screens */
@media (max-height: 600px) {
  .modal-content {
    height: 95vh;
    padding: clamp(6px, 1vw, 12px);
  }

  .modal-header {
    padding-bottom: clamp(3px, 0.5vw, 6px);
    margin-bottom: clamp(4px, 0.8vw, 8px);
  }

  .modal-form-group {
    min-height: clamp(26px, 4vh, 35px);
    margin: clamp(1px, 0.2vw, 3px);
  }

  .modal-footer {
    margin-top: clamp(6px, 1vw, 12px);
  }

  .email-modal-body {
    padding: 12px;
  }

  .email-body-container textarea {
    min-height: 120px;
  }
}

/* ViewFile Modal Specific Styling - Complete Override */
.modal .modal-content.view-file-modal-content {
  /* Force flex layout reset */
  display: flex !important;
  flex-direction: column !important;
  flex-wrap: nowrap !important;

  /* Size and positioning */
  height: clamp(500px, 85vh, 950px) !important;
  width: clamp(650px, 85vw, 1350px) !important;
  max-width: 95vw !important;
  max-height: 95vh !important;

  /* Layout behavior */
  overflow: hidden !important;
  padding: 0 !important;
  margin: 0 !important;
  position: relative !important;

  /* Reset any inherited flex properties */
  align-items: stretch !important;
  justify-content: flex-start !important;
  align-content: stretch !important;
}

.modal .modal-content.view-file-modal-content .view-file-modal-header {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  justify-content: space-between !important;
  position: sticky !important;
  top: 0 !important;
  z-index: 10 !important;
  width: 100% !important;
  background-color: $lighter-green !important;
  border-bottom: 2px solid #ddd !important;
  padding: clamp(6px, 0.8vw, 10px) clamp(8px, 1vw, 16px) !important;
  margin: 0 !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  flex-shrink: 0 !important;
  order: 1 !important; /* Ensure header comes first */

  .header-left {
    @include display-flex($direction: row, $align: center, $justify: flex-start);
    flex: 1;

    .modal-title {
      margin: 0;
      font-size: $small; /* Compact title */
      font-weight: 600;
      color: $text-color;
    }
  }

  .header-right {
    @include display-flex($direction: row, $align: center, $justify: flex-end);
    gap: clamp(8px, 1vw, 12px);

    .header-save-button {
      background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
      color: white;
      border: none;
      padding: clamp(4px, 0.6vw, 8px) clamp(8px, 1vw, 12px); /* Compact button */
      font-size: $small;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);

      &:hover {
        background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.4);
      }

      &:active {
        transform: translateY(0);
      }
    }

    .close-modal-button {
      font-size: clamp(16px, 2vw, 24px); /* Smaller close button */
      font-weight: bold;
      color: #666;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: clamp(2px, 0.3vw, 4px);
      border-radius: 4px;

      &:hover,
      &:focus {
        color: #000;
        background-color: rgba(0, 0, 0, 0.1);
      }
    }
  }
}

.modal .modal-content.view-file-modal-content .view-file-modal-body {
  flex: 1 1 auto !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  padding: clamp(8px, 1vw, 16px) !important;
  width: 100% !important;
  order: 2 !important; /* Ensure body comes after header */

  .modal-body {
    display: flex !important;
    flex-direction: column !important;
    gap: clamp(4px, 0.6vw, 8px) !important;
    width: 100% !important;
    align-items: center !important;
    justify-content: flex-start !important;
  }
}

/* Hide footer for ViewFile modal */
.modal-content.view-file-modal-content .modal-footer {
  display: none !important;
}
